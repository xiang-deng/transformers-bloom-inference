#!/bin/bash
#SBATCH --gpus-per-node=1
#SBATCH --time=12:00:00
#SBATCH --nodes=1
#SBATCH --ntasks=22
#SBATCH --output=bloom_7B1
#SBATCH --account=PAA0201

ifconfig
<<<<<<< HEAD
SIF_IMAGE=/fs/project/PAA0201/LLM_models/transformers-bloom-inference-new/osc/bloom.sif
=======
SIF_IMAGE={PATH_TO_BUILD_IMAGE}
>>>>>>> e1e7ff3c3fb2119d6ced262421d5647e94b84239
singularity exec --nv $SIF_IMAGE bash -c "\
export PYTHONNOUSERSITE=1;
export HOME=/tmp/$USER;
cd /fs/project/PAA0201/LLM_models/transformers-bloom-inference-new;
export TRANSFORMERS_CACHE=/fs/scratch/PAA0201/LLM_models/cache;
export MII_CACHE_PATH=/tmp/$USER/mii_cache;
export TOKENIZERS_PARALLELISM=false;
export MODEL_NAME=bigscience/bloom-7b1;
export DEPLOYMENT_FRAMEWORK=hf_accelerate;
export DTYPE=bf16;
export MAX_INPUT_LENGTH=2048;
export MAX_BATCH_SIZE=256;
export NUM_GPUS=1;
bash start_server.sh
"
